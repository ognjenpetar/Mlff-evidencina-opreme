rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // ===== LOCATIONS =====
    match /locations/{locationId} {
      // Allow public read access (for QR code scanning)
      allow read: if true;

      // Require authentication for create, update, delete
      allow create, update, delete: if isAuthenticated();
    }

    // ===== EQUIPMENT =====
    match /equipment/{equipmentId} {
      // Allow public read access (for QR code scanning)
      allow read: if true;

      // Require authentication for create, update, delete
      allow create, update, delete: if isAuthenticated();

      // ===== DOCUMENTS SUBCOLLECTION =====
      match /documents/{documentId} {
        // Allow public read
        allow read: if true;

        // Require authentication for write operations
        allow create, update, delete: if isAuthenticated();
      }

      // ===== MAINTENANCE SUBCOLLECTION =====
      match /maintenance/{maintenanceId} {
        // Allow public read
        allow read: if true;

        // Require authentication for write operations
        allow create, update, delete: if isAuthenticated();
      }

      // ===== AUDIT LOG SUBCOLLECTION =====
      match /auditLog/{logId} {
        // Allow public read
        allow read: if true;

        // Require authentication for write operations
        allow create, update, delete: if isAuthenticated();
      }
    }

    // ===== CUSTOM EQUIPMENT TYPES =====
    match /customTypes/{typeId} {
      // Allow public read
      allow read: if true;

      // Require authentication for create, update, delete
      allow create, update, delete: if isAuthenticated();
    }
  }
}
